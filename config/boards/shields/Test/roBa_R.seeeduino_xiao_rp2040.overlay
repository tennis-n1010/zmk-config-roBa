/* RP2040 用：nRF書式を全撤去し、RP2040/Zephyrの書式に置換 */
#include "roBa.dtsi"

/* 必要なら行列オフセット（L/R共有ならそのまま）*/
&default_transform { col-offset = <6>; };

/* ---- kscan: &xiao_d を使わず、RP2040の実GPIO番号で直指定に統一 ----
   XIAO RP2040 の D→GPIO 対応（参考）:
   D0=26, D1=27, D2=28, D3=29, D4=6, D5=7, D6=0, D7=1, D8=2, D9=4, D10=3
   ↓あなたが貼ってくれた col（D10,D9,D8,D7,最後はD6の想定）を実GPIOで書き直し
*/
&kscan0 {
    col-gpios =
        <&gpio0 3 GPIO_ACTIVE_HIGH>,  /* D10 */
        <&gpio0 4 GPIO_ACTIVE_HIGH>,  /* D9  */
        <&gpio0 2 GPIO_ACTIVE_HIGH>,  /* D8  */
        <&gpio0 1 GPIO_ACTIVE_HIGH>,  /* D7  */
        <&gpio0 0 GPIO_ACTIVE_HIGH>;  /* D6  */
};

/* ---- PMW3610（SPI） ---- */
/* RP2040は pinctrl=pinmux マクロで割当。nRFの psels/low-power-enable は使わない */
&pinctrl {
    spi0_default: spi0_default {
        group1 {
            /* 例: SCK=GPIO2, MOSI=GPIO3, MISO=GPIO0 に割当（配線に合わせてOK） */
            pinmux = <SPI0_SCK_P2>, <SPI0_TX_P3>, <SPI0_RX_P0>;
        };
    };
};

/* BLEなし・USB検証前提。RP2040用の SPI0 定義 */
&spi0 {
    status = "okay";
    compatible = "raspberrypi,pico-spi";
    pinctrl-names = "default";
    pinctrl-0 = <&spi0_default>;

    /* CS/IRQ は実GPIO直指定。例: CS=D0→GPIO26, IRQ=D1→GPIO27 */
    cs-gpios = <&gpio0 26 GPIO_ACTIVE_LOW>;

    trackball: trackball@0 {
        status = "okay";
        compatible = "pixart,pmw3610";
        reg = <0>;
        /* 2MHzまで推奨。上で pinmux を SPI0_* にしていればOK */
        spi-max-frequency = <2000000>;
        irq-gpios = <&gpio0 27 (GPIO_ACTIVE_LOW | GPIO_PULL_UP)>;

        /* 任意：元の設定を踏襲 */
        automouse-layer = <1>;
        scroll-layers = <4>;
    };
};

/* nRF専用のノード参照は書かない
   例: &xiao_serial { status="disabled"; };  ← RP2040には存在しないので禁止
*/